SELECT p.id, first_name, last_name, gender, education, name FROM
        integrated.person AS p 
        JOIN integrated.person_party ON p.id = person_party.person_id
        JOIN integrated.party ON party.id = person_party.party_id --ALLGEMEIN
        
SELECT COUNT(*) AS cnt, name, (CASE WHEN label = 'Jurist' THEN 'Rechtsanwalt' ELSE label END) AS label FROM
        integrated.person AS p 
        JOIN integrated.person_party ON p.id = person_party.person_id
        JOIN integrated.party ON party.id = person_party.party_id
        JOIN integrated.person_occupation AS po ON p.id = po.person_id
        JOIN integrated.occupation ON occupation.id = po.occupation_id
GROUP BY name, label
HAVING (COUNT(*) >= 3) AND (label <> 'k.A.') AND (label <> 'Politiker') AND (NOT label LIKE 'Md%') AND (NOT label LIKE 'Mitglied%') -- Berufe pro Partei
order by cnt desc

SELECT COUNT(*), name, AVG(2015 - year) AS age FROM
        integrated.person AS p 
        JOIN integrated.person_party ON p.id = person_party.person_id
        JOIN integrated.party ON party.id = person_party.party_id
        JOIN integrated.birth ON p.id = birth.person_id
GROUP BY name --avg age

select count(*), type from integrated.auxiliary_income
group by type

create extension unaccent;

select lower(unaccent(left(last_name, 1))), count(*) from integrated.person
group by lower(unaccent(left(last_name, 1)));

select count(*) from integrated.person_party;

select count(distinct person.id) from integrated.person
join integrated.person_article on person.id = person_article.person_id
join integrated.person_party on person.id = person_party.person_id; -- persons with party and article --> only 79 :-(

select count(distinct person.id) from integrated.person
join integrated.person_article on person.id = person_article.person_id
join integrated.politician on person.id = politician.person_id; -- politicians with article --> only 80 :-(

select count(distinct person.id) from integrated.person
join integrated.person_article on person.id = person_article.person_id
join integrated.author on person.id = author.person_id; -- authors with article --> 832

select count(distinct person.id) from integrated.person
join integrated.almamater on person.id = almamater.person_id
join integrated.work on person.id = work.person_id;  -- persons with university and work --> only 5!!!

select * from integrated.person
where last_name like '%Merkel%' and first_name like '%Angela%' or last_name like '%Angela%' and first_name like '%Merkel%'; -- dbpedia-URI is missing

select * from integrated_undeduplicated.person
where last_name like '%Merkel%' and first_name like '%Angela%' or last_name like '%Angela%' and first_name like '%Merkel%'; -- dbpedia-URI still there in one row

select count(distinct person.id) from integrated.person
join integrated.almamater on person.id = almamater.person_id
join integrated.person_article on person.id = person_article.person_id; -- studied persons in articles --> 35

select count(distinct person.id) from integrated.person
join integrated.almamater on person.id = almamater.person_id
join integrated.politician on person.id = politician.person_id; -- studied politicians --> 35

select count(distinct person.id) from integrated.person
join integrated.author on person.id = author.person_id
join integrated.work on person.id = work.person_id; -- authors with a work --> 1335

select regexp_replace(name, '[??]', '', 'g') from integrated.work
where name like '%?%'; -- remove start of string and string terminator characters

select regexp_replace(name, '?[^?]+?', '', 'g') from integrated.work
where name like '%?%'; -- remove substring between (including) start of string and string terminator characters

-- same-titled works and books
select * from integrated.book
join integrated.work on
lower(title) = lower(name) or lower(title) = lower(regexp_replace(name, '[??]', '', 'g')) or lower(title) = lower(regexp_replace(name, '?[^?]+?', '', 'g'));

